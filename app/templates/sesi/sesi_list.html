<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kelola Sesi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
  <div class="container">
    <h1>Kelola Sesi</h1>
    <p><a href="{{ url_for('admin_bp.admin_dashboard') }}">&larr; Kembali ke Menu</a></p>

    <!-- Filter Form -->
    <form method="get" action="{{ url_for('sesi_bp.sesi_list') }}" class="row g-3 align-items-end mb-4">
      <div class="col-md-4">
        <label class="form-label">Filter Wahana:</label>
        <select name="wahana" class="form-select">
          <option value="">Semua</option>
          {% for w in all_wahana %}
            <option value="{{ w }}" {% if current_wahana == w %}selected{% endif %}>{{ w }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <label class="form-label">Filter Bulan:</label>
        <select name="month" class="form-select">
          <option value="">Semua</option>
          {% for m in all_months %}
            <option value="{{ m }}" {% if current_month == m %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-5">
        <button type="submit" class="btn btn-primary">Terapkan</button>
        <a href="{{ url_for('sesi_bp.sesi_add') }}" class="btn btn-success">+ Tambah Sesi</a>
      </div>
    </form>

    <hr>

    <!-- Show title when filtered -->
    {% if current_wahana %}
      <h2>{{ current_wahana }}</h2>
    {% endif %}

    <!-- Sesi Table(s) -->
    {% for wahana, months in grouped_sesi.items() %}
      {% if not current_wahana %}
        <h2>{{ wahana }}</h2>
      {% endif %}
      {% for month, days in months.items() %}
        <h3>Bulan: {{ month }}</h3>
        {% for day, sesi_list in days.items() %}
          <h4>Tanggal: {{ day }}</h4>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nama Sesi</th>
                <th>Kuota</th>
                <th>Harga</th>
                <th>Mulai</th>
                <th>Selesai</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
              {% for s in sesi_list %}
                <tr>
                  <td>{{ s|col(0) }}</td>
                  <td>{{ s|col(1) }}</td>
                  <td>{{ s|col(2) }}</td>
                  <td>{{ s|col(3) }}</td>
                  <td>{{ s|col(4) }}</td>
                  <td>{{ s|col(5) }}</td>
                  <td>
                    <a href="{{ url_for('sesi_bp.sesi_edit', id=s|col(0)) }}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="{{ url_for('sesi_bp.sesi_delete', id=s|col(0)) }}" class="btn btn-sm btn-danger"
                       onclick="return confirm('Hapus sesi ini?')">Hapus</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endfor %}
      {% endfor %}
    {% else %}
      <p class="text-muted">Tidak ada sesi ditemukan.</p>
    {% endfor %}

    <!-- Pagination controls -->
    {% if total and per_page %}
      {% set total_pages = (total // per_page) + (1 if total % per_page else 0) %}
      <div class="mt-4 d-flex justify-content-center align-items-center gap-3">
        {% if page > 1 %}
          <a href="?page={{ page-1 }}&per_page={{ per_page }}" class="btn btn-outline-primary">&laquo; Sebelumnya</a>
        {% endif %}

        <span>Halaman {{ page }} / {{ total_pages }}</span>

        {% if page < total_pages %}
          <a href="?page={{ page+1 }}&per_page={{ per_page }}" class="btn btn-outline-primary">Selanjutnya &raquo;</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</body>
</html>
