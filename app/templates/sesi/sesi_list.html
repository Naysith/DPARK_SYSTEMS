<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kelola Sesi</title>
</head>
<body>
  <h1>Kelola Sesi</h1>
  <p><a href="{{ url_for('admin_bp.admin_dashboard') }}">&larr; Kembali ke Menu</a></p>

  <form method="get" action="{{ url_for('sesi_bp.sesi_list') }}">
    <label>Filter Wahana:</label>
    <select name="wahana">
      <option value="">Semua</option>
      {% for w in all_wahana %}
        <option value="{{ w }}" {% if current_wahana == w %}selected{% endif %}>{{ w }}</option>
      {% endfor %}
    </select>

    <label>Filter Bulan:</label>
    <select name="month">
      <option value="">Semua</option>
      {% for m in all_months %}
        <option value="{{ m }}" {% if current_month == m %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>

    <button type="submit">Terapkan</button>
    <a href="{{ url_for('sesi_bp.sesi_add') }}">+ Tambah Sesi</a>
  </form>

  <hr>

  {% for wahana, months in grouped_sesi.items() %}
    <h2>{{ wahana }}</h2>
    {% for month, days in months.items() %}
      <h3>Bulan: {{ month }}</h3>
      {% for day, sesi_list in days.items() %}
        <h4>Tanggal: {{ day }}</h4>
        <table border="1" cellpadding="5">
          <tr>
            <th>ID</th>
            <th>Nama Sesi</th>
            <th>Kuota</th>
            <th>Harga</th>
            <th>Mulai</th>
            <th>Selesai</th>
            <th>Aksi</th>
          </tr>
          {% for s in sesi_list %}
            <tr>
              <td>{{ s|col(0) }}</td>
              <td>{{ s|col(1) }}</td>
              <td>{{ s|col(2) }}</td>
              <td>{{ s|col(3) }}</td>
              <td>{{ s|col(4) }}</td>
              <td>{{ s|col(5) }}</td>
              <td>
                <a href="{{ url_for('sesi_bp.sesi_edit', id=s|col(0)) }}">Edit</a> |
                <a href="{{ url_for('sesi_bp.sesi_delete', id=s|col(0)) }}" onclick="return confirm('Hapus sesi ini?')">Hapus</a>
              </td>
            </tr>
          {% endfor %}
        </table>
      {% endfor %}
    {% endfor %}
  {% else %}
    <p>Tidak ada sesi ditemukan.</p>
  {% endfor %}

  <!-- Pagination controls -->
  {% if total and per_page %}
    {% set total_pages = (total // per_page) + (1 if total % per_page else 0) %}
    <div style="margin-top:16px;">
      {% if page > 1 %}
        <a href="?page={{ page-1 }}&per_page={{ per_page }}" style="margin-right:8px;">&laquo; Sebelumnya</a>
      {% endif %}

      Page {{ page }} / {{ total_pages }}

      {% if page < total_pages %}
        <a href="?page={{ page+1 }}&per_page={{ per_page }}" style="margin-left:8px;">Selanjutnya &raquo;</a>
      {% endif %}
    </div>
  {% endif %}
</body>
</html>
